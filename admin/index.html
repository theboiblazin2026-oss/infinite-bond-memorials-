<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Mission Control | Infinite Bond Memorials</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">


</head>

<body>
    <header class="admin-header">
        <div class="container">
            <div class="admin-header__content">
                <div class="logo">
                    <span class="logo__text text-white">Infinite Bond <span>Memorials</span></span>
                </div>
                <div>Mission Control</div>
            </div>
        </div>
    </header>

    <main class="container">
        <h1 class="admin-title">Fulfillment Dashboard</h1>

        <div class="admin-grid">

            <!-- 1. Incoming Orders -->
            <div class="admin-card">
                <h2 class="admin-card__title">1. Incoming Orders</h2>
                <div class="alert-recommendation">
                    <strong>Recommended:</strong> Use the <strong>Order Tracker</strong> below to manage orders.
                </div>
                <p class="admin-text">For full details, use the official dashboard.</p>
                <a href="https://app.snipcart.com/dashboard/orders" target="_blank" rel="noopener"
                    class="btn btn--primary btn-dashboard">
                    Open Snipcart Dashboard
                </a>
            </div>

            <!-- 2. Profit Command Center (CRM) -->
            <div class="admin-card admin-card--border-gold">
                <div class="crm-header-wrapper">
                    <h2 class="admin-card__title">2. Profit Command Center</h2>
                    <span class="crm-badge">LIVE CRM</span>
                </div>

                <div class="crm-stats-grid">
                    <div class="crm-stat-card crm-stat-card--profit">
                        <div class="crm-stat-label">Net Profit</div>
                        <div id="crm-profit" class="crm-stat-value">$-.--</div>
                    </div>
                    <div class="crm-stat-card crm-stat-card--revenue">
                        <div class="crm-stat-label">Revenue</div>
                        <div id="crm-revenue" class="crm-stat-value">$-.--</div>
                    </div>
                    <div class="crm-stat-card crm-stat-card--margin">
                        <div class="crm-stat-label">Margin</div>
                        <div id="crm-margin" class="crm-stat-value">--%</div>
                    </div>
                </div>

                <div>
                    <h4 class="crm-recent-log-header">Recent Profit Log</h4>
                    <table class="crm-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody id="crm-recent-list">
                            <tr>
                                <td colspan="3" class="crm-loading-cell">Loading financials...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <script>
                    async function loadFinancials() {
                        try {
                            const res = await fetch('/.netlify/functions/get-stats');
                            const data = await res.json();

                            if (data.error) throw new Error(data.error);

                            document.getElementById('crm-revenue').textContent = `$${data.totalRevenue}`;
                            document.getElementById('crm-profit').textContent = `$${data.totalProfit}`;
                            document.getElementById('crm-margin').textContent = `${data.margin}%`;

                            const list = document.getElementById('crm-recent-list');
                            list.innerHTML = data.recentOrders.map(o => `
                                <tr class="crm-row">
                                    <td>${o.date.split('-').slice(1).join('/')}</td>
                                    <td class="crm-customer-cell">${o.customer}</td>
                                    <td class="crm-profit-cell">+$${o.profit}</td>
                                </tr>
                            `).join('');
                        } catch (e) {
                            console.error("CRM Error:", e);
                            document.getElementById('crm-recent-list').innerHTML = `<tr><td colspan="3" class="crm-empty-cell">Syncing... (Place 1st order to activate)</td></tr>`;
                            document.getElementById('crm-profit').textContent = '$0.00';
                        }
                    }
                    window.addEventListener('DOMContentLoaded', loadFinancials);
                </script>
            </div>

            <!-- 2. Funeral Home Orders (B2B) -->
            <div class="admin-card admin-card--border-gold">
                <h2 class="admin-card__title">2. Funeral Home B2B <span class="badge-priority">PRIORITY</span></h2>
                <p class="mb-sm"><strong>High-Value Partners.</strong> Process these immediately.</p>

                <div class="flex-col-gap">
                    <div class="info-box">
                        <strong>Quote Requests:</strong>
                        <a href="https://app.snipcart.com/dashboard/orders" target="_blank" rel="noopener"
                            class="link-arrow">Process Quotes in Snipcart &rarr;</a>
                    </div>
                    <div class="info-box">
                        <strong>New Inquiries:</strong>
                        <a href="https://app.netlify.com" target="_blank" rel="noopener" class="link-arrow">View Leads
                            in Netlify &rarr;</a>
                    </div>
                </div>
            </div>

            <!-- 3. LIVE ORDER TRACKER (Google Sheet Embed) -->
            <div class="admin-card admin-card--border-primary admin-card--full-width">
                <div class="tracker-header">
                    <h2 class="admin-card__title tracker-title">3. Live Order Tracker</h2>
                    <button onclick="toggleTrackerSettings()" class="tracker-settings-toggle">‚öôÔ∏è Settings</button>
                </div>

                <!-- Display Area -->
                <div id="tracker-display" class="tracker-display">
                    <!-- Content injected via JS -->
                    <div class="tracker-display-placeholder">
                        <p><strong>Tracker not connected yet.</strong></p>
                        <p>1. Connect to Google Sheets (see Guide).</p>
                        <p>2. Open Sheet &rarr; File &rarr; Share &rarr; Publish to Web &rarr; Embed.</p>
                        <p>3. Click "‚öôÔ∏è Settings" above and paste the code.</p>
                    </div>
                </div>

                <!-- Settings Area (Hidden by default) -->
                <div id="tracker-settings" class="tracker-settings">
                    <label class="tracker-label">Paste Google Sheet Embed Code:</label>
                    <textarea id="embed-input" rows="4" class="tracker-input"
                        placeholder='<iframe src="https://docs.google.com/spreadsheets/d/e/..." ...></iframe>'></textarea>
                    <div class="tracker-actions">
                        <button onclick="saveTrackerEmbed()" class="btn btn--primary btn--small">Save
                            Connection</button>
                        <button onclick="loadDemoTracker()" class="btn btn--outline btn--small btn-demo">Running a Test?
                            Load Demo Data</button>
                        <button onclick="toggleTrackerSettings()" class="btn btn--outline btn--small">Cancel</button>
                    </div>
                </div>

                <!-- Fallback Link (Always Visible if tracker is loaded) -->
                <div id="tracker-fallback" class="tracker-fallback">
                    <a id="fallback-link" href="#" target="_blank" rel="noopener" class="tracker-fallback-link">
                        Tracker blank? Click here to open in new tab
                    </a>
                </div>

                <script>
                    // Simple local logic for the tracker embed
                    const STORAGE_KEY = 'admin_tracker_embed';

                    function loadTracker() {
                        const savedCode = localStorage.getItem(STORAGE_KEY);
                        const display = document.getElementById('tracker-display');
                        const input = document.getElementById('embed-input');

                        if (savedCode) {
                            display.innerHTML = savedCode;
                            const iframe = display.querySelector('iframe');
                            if (iframe) {
                                iframe.style.width = '100%';
                                iframe.style.height = '500px';
                                iframe.style.border = 'none';
                                iframe.style.borderRadius = '8px';
                            }
                            input.value = savedCode;

                            // Update fallback link
                            const srcMatch = savedCode.match(/src="([^"]+)"/);
                            if (srcMatch && srcMatch[1]) {
                                const fallbackLink = document.getElementById('fallback-link');
                                const fallbackDiv = document.getElementById('tracker-fallback');
                                fallbackLink.href = srcMatch[1];
                                fallbackDiv.style.display = 'block';
                            }
                        }
                    }

                    function saveTrackerEmbed() {
                        const code = document.getElementById('embed-input').value;
                        if (code.trim()) {
                            localStorage.setItem(STORAGE_KEY, code);
                            loadTracker();
                            toggleTrackerSettings();
                        } else {
                            alert("Please paste the embed code first!");
                        }
                    }

                    function loadDemoTracker() {
                        const demoTable = `
                            <div class="demo-table-wrapper">
                                <table class="demo-table">
                                    <thead>
                                        <tr>
                                            <th>Order #</th>
                                            <th>Date</th>
                                            <th>Customer</th>
                                            <th>Product</th>
                                            <th class="demo-table th--center">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>SNIP-1024</td>
                                            <td>Jan 14</td>
                                            <td>John Doe</td>
                                            <td>Photo Blanket (60x80)</td>
                                            <td class="demo-table td--center"><span class="status-badge status-badge--shipped">Shipped</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <p class="demo-table-note">(This is a demo. Your real Google Sheet will replace this.)</p>
                            </div>
                        `;
                        document.getElementById('tracker-display').innerHTML = demoTable;
                        toggleTrackerSettings();
                    }

                    function toggleTrackerSettings() {
                        const settings = document.getElementById('tracker-settings');
                        const display = document.getElementById('tracker-display');

                        if (settings.style.display === 'none') {
                            settings.style.display = 'block';
                            display.style.display = 'none';
                        } else {
                            settings.style.display = 'none';
                            display.style.display = 'block';
                        }
                    }
                    window.addEventListener('DOMContentLoaded', loadTracker);
                </script>
            </div>

            <!-- 4. Vendor Routing & Integrations -->
            <div class="admin-card">
                <h2 class="admin-card__title">4. Vendor Routing & Integrations</h2>
                <div class="webhook-box">
                    <strong>Webhook URL:</strong> <span id="webhook-url-display" class="webhook-url">Loading...</span>
                    <button onclick="copyWebhook()" class="webhook-copy-btn">Copy</button>
                    <p class="webhook-note">Paste this URL into your vendor settings to auto-sync shipments.</p>
                </div>

                <ul class="vendor-list">
                    <!-- CustomCat - OVERNIGHT -->
                    <li class="vendor-item vendor-item--wrap vendor-item--customcat">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--customcat">‚ö° CustomCat</strong> <span
                                    class="text-gray-sm">(Overnight Pillows, Blankets, Portraits)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-customcat')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://customcat.com/dashboard" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-customcat" class="vendor-setup--customcat">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Dashboard ‚Üí API Settings.</li>
                                <li>Copy your <strong>API Key</strong>.</li>
                                <li>Add to Netlify Environment Variables.</li>
                                <li>Orders auto-route when AUTOPILOT_PILLOW is ON.</li>
                            </ol>
                        </div>
                    </li>

                    <!-- SPOD - 48hr -->
                    <li class="vendor-item vendor-item--wrap vendor-item--spod">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--spod">üöÄ SPOD (Spreadshirt)</strong> <span
                                    class="text-gray-sm">(48hr Shirts, Hoodies)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-spod')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://partner.spreadshirt.com/dashboard" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-spod" class="vendor-setup--spod">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Dashboard ‚Üí API Access.</li>
                                <li>Generate <strong>API Token</strong>.</li>
                                <li>Add SPOD_API_KEY to Netlify.</li>
                            </ol>
                        </div>
                    </li>

                    <!-- Contrado - Premium -->
                    <li class="vendor-item vendor-item--wrap vendor-item--contrado">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--contrado">‚ú® Contrado</strong> <span
                                    class="text-gray-sm">(Premium Textiles, 1-2 days)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-contrado')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://www.contrado.com/account" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-contrado" class="vendor-setup--contrado">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Account ‚Üí API/Developer section.</li>
                                <li>Generate API credentials.</li>
                                <li>Add CONTRADO_API_KEY to Netlify.</li>
                            </ol>
                        </div>
                    </li>

                    <!-- Celebrate Prints - Same Day -->
                    <li class="vendor-item vendor-item--wrap vendor-item--celebrate">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--celebrate">üé® Celebrate Prints</strong> <span
                                    class="text-gray-sm">(Same-Day Cap Panels)</span></div>
                            <div>
                                <span class="vendor-manual-tag">Manual Orders</span>
                                <a href="https://celebrateprints.com" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                    </li>

                    <!-- Trupoint Memorials - Urns -->
                    <li class="vendor-item vendor-item--wrap vendor-item--trupoint">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--trupoint">üè∫ Trupoint Memorials</strong> <span
                                    class="text-gray-sm">(Photo Urns, 5-day)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-trupoint')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://trupointmemorials.com" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-trupoint" class="vendor-setup--trupoint">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Contact for API access or use manual ordering.</li>
                                <li>Add TRUPOINT_API_KEY to Netlify if available.</li>
                            </ol>
                        </div>
                    </li>
                </ul>

                <!-- Standard Vendors Section (moved outside ul to fix HTML structure) -->
                <hr class="vendor-divider">
                <p class="vendor-section-label">‚Äî Standard Vendors ‚Äî</p>

                <ul class="vendor-list">
                    <li class="vendor-item vendor-item--wrap vendor-item--printful">
                        <div class="vendor-content-row">
                            <div><strong class="vendor-name--printful">Printful</strong> <span
                                    class="text-gray-sm">(Apparel, Mugs, Candles)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-printful')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://www.printful.com/dashboard/orders" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-printful" class="vendor-setup--printful">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Create Order -> Paste <strong>Reference ID</strong> (e.g. SNIP-1024).</li>
                                <li>Settings > API > Webhooks.</li>
                                <li>Paste <strong>Webhook URL</strong> above.</li>
                                <li>Check <strong>"Package Shipped"</strong>.</li>
                                <li>Save.</li>
                            </ol>
                        </div>
                    </li>

                    <li class="vendor-item vendor-item--wrap">
                        <div class="vendor-content-row">
                            <div><strong class="text-printify">Printify</strong> <span class="text-gray-sm">(Standard
                                    Blankets)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-printify')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://printify.com/app/orders" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-printify" class="vendor-setup-panel">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Orders > Create -> Paste <strong>External ID</strong> (e.g. SNIP-1024).</li>
                                <li>Settings > API > Webhooks.</li>
                                <li>Topic: <strong>"Order Shipment Created"</strong>.</li>
                                <li>Paste <strong>Webhook URL</strong> above.</li>
                                <li>Create Hook.</li>
                            </ol>
                        </div>
                    </li>

                    <li class="vendor-item vendor-item--wrap">
                        <div class="vendor-content-row">
                            <div><strong class="text-gooten">Gooten</strong> <span class="text-gray-sm">(Ornaments,
                                    Gifts)</span></div>
                            <div>
                                <button onclick="toggleSetup('setup-gooten')"
                                    class="btn btn--outline btn--small btn-setup">Setup</button>
                                <a href="https://www.gooten.com/admin" target="_blank" rel="noopener"
                                    class="btn btn--primary btn--small">Login</a>
                            </div>
                        </div>
                        <div id="setup-gooten" class="vendor-setup--gooten">
                            <strong>Setup Steps:</strong>
                            <ol class="vendor-setup-steps">
                                <li>Paste <strong>Ref ID</strong> when ordering.</li>
                                <li>Settings > API.</li>
                                <li>Paste <strong>Webhook URL</strong> in Postback/Webhook field.</li>
                            </ol>
                        </div>
                    </li>
                </ul>
                <script>
                    function toggleSetup(id) {
                        const el = document.getElementById(id);
                        el.style.display = el.style.display === 'none' ? 'block' : 'none';
                    }

                    document.addEventListener('DOMContentLoaded', () => {
                        // Build Webhook URL dynamically based on current domain
                        // If running locally (localhost), warn user it won't work for real vendors
                        const origin = window.location.origin;
                        let webhookUrl = origin + '/.netlify/functions/pod-webhook';
                        const display = document.getElementById('webhook-url-display');

                        if (origin.includes('localhost') || origin.includes('127.0.0.1')) {
                            // On localhost, show the PRODUCTION URL so the user can actually use it
                            webhookUrl = 'https://infintiebondmemorial.netlify.app/.netlify/functions/pod-webhook';
                            display.style.color = '#006064'; // standard text color

                            // Add a small helpful note
                            const note = document.createElement('div');
                            note.style.fontSize = '0.8em';
                            note.style.color = '#f59e0b'; // warning orange
                            note.style.marginTop = '2px';
                            note.innerText = '‚ú® Showing Production URL (for vendor settings)';
                            display.parentNode.appendChild(note);
                        }

                        display.innerText = webhookUrl;
                    });

                    function copyWebhook() {
                        const url = document.getElementById('webhook-url-display').innerText;
                        navigator.clipboard.writeText(url).then(() => {
                            alert('Webhook URL copied!');
                        });
                    }
                </script>
            </div>

            <!-- 5. AUTOPILOT CONSOLE -->
            <div class="admin-card">
                <h2 class="admin-card__title">5. Autopilot Console ü§ñ</h2>
                <div class="autopilot-status-row">
                    <p class="admin-text autopilot-status-text"><strong>Status:</strong> Automatically route orders to
                        vendors.</p>
                </div>

                <div class="autopilot-grid">

                    <!-- Global Master Switch -->
                    <div class="autopilot-item autopilot-master-toggle">
                        <strong>MASTER CONTROL</strong>
                        <label class="switch">
                            <input type="checkbox" id="toggle-global" title="Master autopilot control"
                                onchange="updateAutopilot('AUTOPILOT_GLOBAL', this.checked)">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <!-- Fast Fulfillment Products (NEW) -->
                    <p class="autopilot-section-header">‚ö° FAST FULFILLMENT (1-2 days)</p>

                    <div class="autopilot-item item-row item-row--green">
                        <span>‚ö° Keepsake Pillow <small class="vendor-tag">(CustomCat)</small></span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-pillow" title="Autopilot for pillows"
                                onchange="updateAutopilot('AUTOPILOT_PILLOW', this.checked)">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="autopilot-item item-row item-row--green">
                        <span>‚ö° Framed Portrait <small class="vendor-tag">(CustomCat)</small></span>
                        <label class="switch">
                            <input type="checkbox" id="toggle-portrait" title="Autopilot for portraits"
                                onchange="updateAutopilot('AUTOPILOT_PORTRAIT', this.checked)">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div class="autopilot-item item-row item-row--orange">
                        <div class="item-row item-row--blue">
                            <span>‚òÅÔ∏è Blankets <small class="text-gray-sm">(Printify/CustomCat)</small></span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-blanket" title="Autopilot for blankets"
                                    onchange="updateAutopilot('AUTOPILOT_BLANKET', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="item-row item-row--blue">
                            <span>üëï T-Shirts <small class="text-gray-sm">(SPOD)</small></span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-tshirt" title="Autopilot for t-shirts"
                                    onchange="updateAutopilot('AUTOPILOT_TSHIRT', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="item-row">
                            <span>Mugs / Candles <small class="text-gray-sm">(Gooten)</small></span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-mug" title="Autopilot for mugs"
                                    onchange="updateAutopilot('AUTOPILOT_MUG', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="item-row">
                            <span>Comfort Package (Bundle)</span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-comfort" title="Autopilot for bundles"
                                    onchange="updateAutopilot('AUTOPILOT_COMFORT', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <!-- Specialty Products -->
                        <p class="section-label-specialty">üè∫ SPECIALTY ITEMS (Manual/Inquiry)</p>

                        <div class="item-row item-row--pink">
                            <span>üè∫ Photo Urns <small class="text-gray-sm">(Trupoint)</small></span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-urn" title="Autopilot for urns"
                                    onchange="updateAutopilot('AUTOPILOT_URN', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="item-row item-row--blue">
                            <span>üé® Cap Panels <small class="text-gray-sm">(Celebrate Prints)</small></span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-cappanel" title="Autopilot for cap panels"
                                    onchange="updateAutopilot('AUTOPILOT_CAPPANEL', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="item-row">
                            <span>Other / Default</span>
                            <label class="switch">
                                <input type="checkbox" id="toggle-default" title="Default autopilot"
                                    onchange="updateAutopilot('AUTOPILOT_DEFAULT', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>

                    </div>



                    <script>
                        async function fetchSettings() {
                            try {
                                const res = await fetch('/.netlify/functions/manage-settings');
                                const settings = await res.json();

                                // Map settings to toggles
                                document.getElementById('toggle-global').checked = settings['AUTOPILOT_GLOBAL'] === 'ON';
                                document.getElementById('toggle-blanket').checked = settings['AUTOPILOT_BLANKET'] === 'ON';
                                document.getElementById('toggle-tshirt').checked = settings['AUTOPILOT_TSHIRT'] === 'ON';
                                document.getElementById('toggle-mug').checked = settings['AUTOPILOT_MUG'] === 'ON';
                                document.getElementById('toggle-comfort').checked = settings['AUTOPILOT_COMFORT'] === 'ON';
                                document.getElementById('toggle-default').checked = settings['AUTOPILOT_DEFAULT'] === 'ON';

                            } catch (e) { console.error('Error fetching settings', e); }
                        }

                        async function updateAutopilot(key, isChecked) {
                            const val = isChecked ? 'ON' : 'OFF';
                            // Visual feedback (optional)
                            console.log(`Setting ${key} to ${val}`);

                            try {
                                await fetch('/.netlify/functions/manage-settings', {
                                    method: 'POST',
                                    body: JSON.stringify({ key: key, value: val })
                                });
                            } catch (e) {
                                alert('Failed to save setting');
                            }
                        }

                        // Load on start
                        window.addEventListener('DOMContentLoaded', fetchSettings);
                    </script>
                </div>

                <!-- 6. CRM & Financials -->
                <div class="admin-card">
                    <h2 class="admin-card__title">6. CRM & Financials</h2>
                    <div class="flex-col-gap">
                        <a href="https://app.snipcart.com/dashboard/customers" target="_blank" rel="noopener"
                            class="btn btn--outline btn-dashboard">Customer CRM</a>
                        <a href="https://app.snipcart.com/dashboard/refunds" target="_blank" rel="noopener"
                            class="btn btn--outline btn-dashboard btn-dashboard--danger">Disputes & Refunds</a>
                    </div>
                </div>

                <!-- 7. Quick Links -->
                <div class="admin-card">
                    <h2 class="admin-card__title">7. Quick Actions</h2>
                    <div class="flex-col-gap">
                        <a href="../" target="_blank" class="btn btn--outline">View Live Store</a>
                        <a href="https://analytics.google.com/" target="_blank" rel="noopener"
                            class="btn btn--outline">Google
                            Analytics</a>
                    </div>
                </div>

                <!-- 8. Daily Operations & SOP (Critical) -->
                <div class="admin-card admin-card--full-width admin-card--border-gold">
                    <div class="crm-header-wrapper">
                        <h2 class="admin-card__title">üìã Daily Operations Checklist</h2>
                        <span class="badgex sop-badge--failsafe">FAIL-SAFE
                            PROTOCOL</span>
                    </div>

                    <div class="sop-wrapper">

                        <!-- Left: Daily Routine -->
                        <div class="sop-section-morning">
                            <h3 class="sop-title">‚òÄÔ∏è Morning Routine (9 AM)</h3>
                            <ul class="sop-checklist">
                                <li class="sop-check-item">
                                    <input type="checkbox" id="sop-1">
                                    <label for="sop-1"><strong>1. Check Emails:</strong> Look for "‚ö†Ô∏è ACTION REQUIRED"
                                        alerts from system.</label>
                                </li>
                                <li class="sop-check-item">
                                    <input type="checkbox" id="sop-2">
                                    <label for="sop-2"><strong>2. Open Tracker:</strong> Check "Live Order Tracker"
                                        above
                                        for Red Flags.</label>
                                </li>
                                <li class="sop-check-item">
                                    <input type="checkbox" id="sop-3">
                                    <label for="sop-3"><strong>3. Manual Orders:</strong> Process any Contrado/Trupoint
                                        orders immediately.</label>
                                </li>
                                <li class="sop-check-item">
                                    <input type="checkbox" id="sop-4">
                                    <label for="sop-4"><strong>4. Update Tracking:</strong> Copy tracking #s from
                                        Vendors ->
                                        Snipcart.</label>
                                </li>
                            </ul>
                        </div>

                        <!-- Right: Emergency Backups -->
                        <div class="sop-section-backup">
                            <h3 class="sop-title sop-title--danger">
                                üö® Emergency Backups (Fail-Safe)</h3>

                            <div class="mb-sm">
                                <strong>If CustomCat Fails (Overnight):</strong>
                                <p class="admin-note backup-note">Log in to <strong>Printify</strong> -> Use
                                    provider <strong>"Monster Digital"</strong> (Fastest alternative).</p>
                            </div>

                            <div class="mb-sm">
                                <strong>If Contrado Fails (Premium):</strong>
                                <p class="admin-note backup-note">Log in to <strong>Prodigi</strong> or
                                    <strong>Printful</strong> (Premium Line).
                            </div>

                            <!-- CONTENT MANAGEMENT SECTION -->
                            <h2 class="admin-title content-section-title">Content Management</h2>
                            <div class="admin-grid">

                                <!-- Product & Price Editor -->
                                <div class="admin-card admin-card--full-width">
                                    <h2 class="admin-card__title">üì¶ Product & Price Editor</h2>
                                    <p class="admin-text content-intro-text">Edit product prices below. Click
                                        "Generate Code" to
                                        get the updated HTML.</p>

                                    <div id="product-editor">
                                        <table class="editor-table">
                                            <thead>
                                                <tr>
                                                    <th class="editor-th">Product</th>
                                                    <th class="editor-th">Current Price</th>
                                                    <th class="editor-th">New Price</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="editor-td">Photo Blanket</td>
                                                    <td class="editor-td">$64.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-blanket" value="64.99" class="editor-input"
                                                            aria-label="Price for Photo Blanket"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Memorial T-Shirt</td>
                                                    <td class="editor-td">$29.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-tshirt" value="29.99" class="editor-input"
                                                            aria-label="Price for Memorial T-Shirt"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Custom Mug</td>
                                                    <td class="editor-td">$24.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-mug" value="24.99" class="editor-input"
                                                            aria-label="Price for Custom Mug"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Memorial Candle</td>
                                                    <td class="editor-td">$34.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-candle" value="34.99" class="editor-input"
                                                            aria-label="Price for Memorial Candle"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Keychain</td>
                                                    <td class="editor-td">$19.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-keychain" value="19.99" class="editor-input"
                                                            aria-label="Price for Keychain"></td>
                                                </tr>
                                                <tr class="item-row--pink">
                                                    <td class="editor-td"><strong>Comfort Package</strong></td>
                                                    <td class="editor-td">$99.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-comfort" value="99.99" class="editor-input"
                                                            aria-label="Price for Comfort Package"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Keepsake Collection</td>
                                                    <td class="editor-td">$45.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-keepsake" value="45.99" class="editor-input"
                                                            aria-label="Price for Keepsake Collection"></td>
                                                </tr>
                                                <tr>
                                                    <td class="editor-td">Remembrance Bundle</td>
                                                    <td class="editor-td">$55.99</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-remembrance" value="55.99" class="editor-input"
                                                            aria-label="Price for Remembrance Bundle">
                                                    </td>
                                                </tr>
                                                <tr class="item-row--blue">
                                                    <td class="editor-td"><strong>Rush Order</strong></td>
                                                    <td class="editor-td">$15.00</td>
                                                    <td class="editor-td"><input type="number" step="0.01"
                                                            id="price-rush" value="15.00" class="editor-input"
                                                            aria-label="Price for Rush Order"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="price-guide-box">
                                            <p class="mb-sm"><strong>üí° How to update prices:</strong></p>
                                            <ol class="vendor-setup-list">
                                                <li>Edit the prices in the table above</li>
                                                <li>Use "Find & Replace" in your code editor</li>
                                                <li>Search for the old price (e.g.,
                                                    <code>data-item-price="64.99"</code>)
                                                </li>
                                                <li>Replace with the new price</li>
                                                <li>Deploy to Netlify</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>

                                <!-- Page Header Editor -->
                                <div class="admin-card">
                                    <h2 class="admin-card__title">üìù Page Headers</h2>
                                    <p class="admin-text mb-sm">Edit key page text content.</p>

                                    <div class="flex-col-gap">
                                        <div>
                                            <label class="form-label" for="header-hero">Homepage Hero Title</label>
                                            <input type="text" id="header-hero"
                                                value="Keep Their Memory Close to Your Heart" class="form-input">
                                        </div>
                                        <div>
                                            <label class="form-label" for="header-subtitle">Homepage Hero
                                                Subtitle</label>
                                            <textarea id="header-subtitle" rows="2"
                                                class="form-input">Premium personalized memorial products crafted with love, designed to honor and celebrate the lives of those who meant the most.</textarea>
                                        </div>
                                        <div>
                                            <label class="form-label" for="header-products">Products Page Title</label>
                                            <input type="text" id="header-products" value="Memorial Products"
                                                class="form-input">
                                        </div>
                                    </div>

                                    <div class="admin-note-box">
                                        <p class="admin-note"><strong>Note:</strong> Copy this text and use Find &
                                            Replace in HTML files to update.</p>
                                    </div>
                                </div>

                                <!-- Image Upload Reference -->
                                <div class="admin-card">
                                    <h2 class="admin-card__title">üñºÔ∏è Product Images</h2>
                                    <p class="admin-text">Manage product images for the store.</p>

                                    <div class="image-info-box">
                                        <p class="image-info-title"><strong>Image Location:</strong></p>
                                        <code class="image-path-code">/assets/images/</code>

                                        <p class="image-info-title mt-md"><strong>Current Product
                                                Images:</strong></p>
                                        <ul class="image-list">
                                            <li>memorial_blanket_*.png</li>
                                            <li>memorial_tshirt_*.png</li>
                                            <li>memorial_mug_*.png</li>
                                            <li>memorial_candle_*.png</li>
                                            <li>memorial_gift_set_*.png</li>
                                        </ul>

                                        <p class="image-info-title mt-md"><strong>To update
                                                images:</strong>
                                        </p>
                                        <ol class="image-update-steps">
                                            <li>Replace files in <code>/assets/images/</code></li>
                                            <li>Use same filename OR update HTML</li>
                                            <li>Recommended size: 800x800px</li>
                                        </ol>
                                    </div>

                                    <a href="https://github.com/" target="_blank" rel="noopener"
                                        class="btn btn--outline btn--mt-md">
                                        Upload via GitHub
                                    </a>
                                </div>

                            </div>
    </main>

    <footer class="footer admin-footer">
        <p>&copy; 2026 Infinite Bond Internal.</p>
    </footer>
</body>

</html>